<?xml version="1.0" encoding="UTF-8"?>
<project name="run-eh-meter" default="run">

	<property name="dir.build" value="../aopmetrics" />
	<property name="dir.work" value="${dir.build}/work" />
	<property name="dir.classes" value="${dir.work}/classes" />
	<property name="dir.testclasses" value="${dir.work}/testclasses" />
	
	
	<property name="dir.dist" value="${dir.work}/dist" />
	<property name="dir.librariesEHMeter" value="${dir.build}/libs" />
	<property name="dir.lib" value="../lib" />
	
	<!--property name="dir.plugins" value="../../../plugins" /-->
	<property name="dir.plugins" value="C:\Desenvolvimento\eclipse-mestrado-3\plugins\" />
	
	<property name="dir.src" value="../src" />

	<property name="jar.name" value="project-analising.jar"/>

	<path id="classpath.common">
		<fileset dir="${dir.lib}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${dir.librariesEHMeter}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${dir.plugins}">
			<include name="*.jar" />
		</fileset>
		
	</path>
			<target name="viewProperties">
				<echo>dir.build:= "${dir.build}"</echo>
				<echo>dir.work:= "${dir.work}"</echo>
				<echo>dir.classes:= "${dir.classes}"</echo>
				<echo>dir.dist:= "${dir.dist}"</echo>
				<echo>dir.librariesEHMeter:= "${dir.librariesEHMeter}"</echo>
				<echo>dir.src:= "${dir.src}"</echo>
				<echo>Done...</echo>
			</target>

	<target name="clean">
		<delete dir="${dir.build}" />
		<delete dir="${dir.dist}" />
	</target>

	<target name="compile"  depends="viewProperties">
		<taskdef 
		      resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties">
		    <classpath>
		      <pathelement location="${dir.librariesEHMeter}/aspectjtools-1.5.1.jar"/>
		    </classpath>
		  </taskdef>

		<mkdir dir="${dir.classes}" />
		<echo  message="passou por aqui..."> - ${ant.version} </echo>
		<!--javac classpathref="classpath.common" source="1.5" fork="true" destdir="${dir.classes}" srcdir="${dir.src}">
			<sourcepath path="${dir.src}"></sourcepath>
		</javac-->
	    <iajc destdir="${dir.classes}"
	    		classpathref="classpath.common"
	    		source="1.5" fork="false" >
			<sourceroots>
		    	<pathelement location="${dir.src}"/>
		    </sourceroots>
		</iajc>
		
	</target>
	
	<target name="jar" depends="compile" description="Creates JAR.">
		<jar destfile="${dir.work}/${jar.name}">
			<fileset dir="${dir.classes}">
				<include name="**/*.class" />
			</fileset>
		</jar>
	</target>
	
	<target name="run" description="Computes metrics on the project.">
		<taskdef name="ehmeter" classname="br.upe.dsc.ehmeter.EHMeterTask" 
			classpath="${dir.librariesEHMeter}/ehmeter-0.4.1.jar">
			<classpath location="${dir.work}/${jar.name}"/>
		</taskdef>
			<mkdir dir="${dir.testclasses}" />
		
		<ehmeter workdir="${dir.work}" sourcelevel="1.5" export="xls"
				resultsfile="${dir.work}/metrics-results.xls">
			<fileset dir="${dir.src}" includes="**/*.java"/>
			<classpath refid="classpath.common"/>
		</ehmeter>
	</target>
	

</project>
