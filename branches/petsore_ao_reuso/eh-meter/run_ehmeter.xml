<?xml version="1.0" encoding="UTF-8"?>
<project name="run-eh-meter-eimp" default="run">

	<property name="dir.build" value="../eh-meter" />
	<property name="dir.work" value="${dir.build}/work" />
	<property name="dir.classes" value="${dir.work}/classes" />
	<property name="dir.classes2" value="${dir.work}/classesnls" />
	<property name="dir.testclasses" value="${dir.work}/testclasses" />
	
	<property name="dir.librariesEHMeter" value="${dir.build}/libs" />
	<property name="dir.dist" value="${dir.work}/dist" />
	<property name="dir.libraries" value="${dir.build}/libs" />
	<property name="dir.librariesEIMP" value="../lib" />
	<property name="dir.plugins" value="C:\Development\eclipseMM\plugins" />
	<property name="dir.src" value="../src" />
	<property name="dir.reusable.src2" value="C:\Development\workspaceMM\ReusableCode\src2" />

	<property name="version" value="0.3"/>
	<property name="jar.name" value="project-analising.jar"/>

	<path id="classpath.common">
		<fileset dir="${dir.libraries}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${dir.plugins}">
			<include name="*.jar" />
		</fileset>	
		<fileset dir="${dir.librariesEIMP}">
			<include name="*.jar" />
		</fileset>
	</path>
	
	<target name="viewProperties">
			<echo>dir.build:= "${dir.build}"</echo>
			<echo>dir.work:= "${dir.work}"</echo>
			<echo>dir.classes:= "${dir.classes}"</echo>
			<echo>dir.dist:= "${dir.dist}"</echo>
			<echo>dir.librariesAOPM:= "${dir.librariesAOPM}"</echo>
			<echo>dir.src:= "${dir.src}"</echo>
			<echo>version:= "${version}"</echo>
			<echo>Done...</echo>
	</target>

	<target name="clean">
		<delete dir="${dir.build}" />
		<delete dir="${dir.dist}" />
	</target>

	<!--target name="compile"  depends="viewProperties">
		<taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties">
		    <classpath>
		      <pathelement location="${dir.librariesAOPM}/aspectjtools-1.5.1.jar"/>
		    </classpath>
		</taskdef>
		<mkdir dir="${dir.classes}" />
		<echo  message="passou por aqui..."> - ${ant.version} </echo>
	    <iajc destdir="${dir.classes}" classpathref="classpath.common" source="1.5" fork="true" >
			<sourceroots>
				<pathelement location="${dir.src}"/>
				<pathelement location="${dir.reusable.src2}" />
		    </sourceroots>
		</iajc>
		
	</target-->
	
	<target name="compile"  depends="viewProperties">
			<taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties">
			    <classpath>
			      <pathelement location="${dir.librariesEHMeter}/aspectjtools-1.6.1.jar"/>
			    </classpath>
			</taskdef>
			<echo  message="passou por aqui...target 1.6.6 criada...5"></echo>
			<mkdir dir="${dir.classes}" />
			<iajc destdir="${dir.classes}" classpathref="classpath.common" source="1.6" fork="true" >
				<sourceroots>
					<pathelement location="${dir.reusable.src2}"/>
			    	<pathelement location="${dir.src}"/>
			    </sourceroots>
			</iajc>
	</target>
	
	<target name="jar" depends="compile" description="Creates JAR.">
		<jar destfile="${dir.work}/${jar.name}">
			<fileset dir="${dir.classes}">
				<include name="**/*.class" />
			</fileset>
		</jar>
	</target>
	
	<target name="run" description="Computes metrics on the project.">
		<taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties" classpath="libs\aspectjtools-1.6.1.jar"/>
		<property name="taskdefs.init" value="true"/>
		
		<taskdef name="ehmeter" classname="br.upe.dsc.ehmeter.EHMeterTask" classpath="${dir.librariesEHMeter}/ehmeter-0.4.1.jar">
			<classpath location="${dir.work}/${jar.name}"/>
		</taskdef>
		<mkdir dir="${dir.testclasses}" />
		<ehmeter workdir="${dir.work}" sourcelevel="1.5" export="xls" resultsfile="${dir.work}/metrics-results.xls">
			<fileset dir="${dir.src}" includes="**/*.java"/>
			<fileset dir="${dir.src}" includes="**/*.aj"/>
			<fileset dir="${dir.reusable.src2}" includes="**/*.aj"/>
			<classpath refid="classpath.common"/>
		</ehmeter>
	</target>
	
</project>
